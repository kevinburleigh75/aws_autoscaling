##
## Stack Creation
##

export NON_MIGRATION_IMAGE_ID=ami-37884c4d
export ONE_DESIRED_CAPACITY=3
export TWO_DESIRED_CAPACITY=1

export MIGRATION_IMAGE_ID=ami-37884c4d
export MIGRATION_DESIRED_CAPACITY=0

aws cloudformation create-stack \
  --template-url https://s3.amazonaws.com/kevin-templates/ElbTemplate.json \
  --parameters \
      ParameterKey=EnvName,ParameterValue=blah \
      ParameterKey=BranchNameOrSha,ParameterValue=klb_elb_expers \
      ParameterKey=KeyName,ParameterValue=kevin_va_kp \
      ParameterKey=RepoUrl,ParameterValue=https://github.com/kevinburleigh75/aws_autoscaling.git \
      ParameterKey=NonMigrationImageId,ParameterValue=$NON_MIGRATION_IMAGE_ID \
      ParameterKey=MigrationImageId,ParameterValue=$MIGRATION_IMAGE_ID \
      ParameterKey=MigrationAsgDesiredCapacity,ParameterValue=$MIGRATION_DESIRED_CAPACITY \
      ParameterKey=OneAsgDesiredCapacity,ParameterValue=$ONE_DESIRED_CAPACITY \
      ParameterKey=TwoAsgDesiredCapacity,ParameterValue=$TWO_DESIRED_CAPACITY \
  --stack-name Stack1

##
## Migration
##

export NON_MIGRATION_IMAGE_ID=ami-37884c4d
export ONE_DESIRED_CAPACITY=3
export TWO_DESIRED_CAPACITY=1

export MIGRATION_IMAGE_ID=ami-37884c4dami-05679357ab362f128
export MIGRATION_DESIRED_CAPACITY=1

aws cloudformation update-stack \
  --template-url https://s3.amazonaws.com/kevin-templates/ElbTemplate.json \
  --parameters \
      ParameterKey=EnvName,ParameterValue=blah \
      ParameterKey=BranchNameOrSha,ParameterValue=klb_elb_expers \
      ParameterKey=KeyName,ParameterValue=kevin_va_kp \
      ParameterKey=RepoUrl,ParameterValue=https://github.com/kevinburleigh75/aws_autoscaling.git \
      ParameterKey=NonMigrationImageId,ParameterValue=$NON_MIGRATION_IMAGE_ID \
      ParameterKey=MigrationImageId,ParameterValue=$MIGRATION_IMAGE_ID \
      ParameterKey=MigrationAsgDesiredCapacity,ParameterValue=$MIGRATION_DESIRED_CAPACITY \
      ParameterKey=OneAsgDesiredCapacity,ParameterValue=$ONE_DESIRED_CAPACITY \
      ParameterKey=TwoAsgDesiredCapacity,ParameterValue=$TWO_DESIRED_CAPACITY \
  --stack-name Stack1

##
## Code
##

export NON_MIGRATION_IMAGE_ID=ami-05679357ab362f128
export ONE_DESIRED_CAPACITY=3
export TWO_DESIRED_CAPACITY=1

export MIGRATION_IMAGE_ID=ami-37884c4dami-05679357ab362f128
export MIGRATION_DESIRED_CAPACITY=0

aws cloudformation update-stack \
  --template-url https://s3.amazonaws.com/kevin-templates/ElbTemplate.json \
  --parameters \
      ParameterKey=EnvName,ParameterValue=blah \
      ParameterKey=BranchNameOrSha,ParameterValue=klb_elb_expers \
      ParameterKey=KeyName,ParameterValue=kevin_va_kp \
      ParameterKey=RepoUrl,ParameterValue=https://github.com/kevinburleigh75/aws_autoscaling.git \
      ParameterKey=NonMigrationImageId,ParameterValue=$NON_MIGRATION_IMAGE_ID \
      ParameterKey=MigrationImageId,ParameterValue=$MIGRATION_IMAGE_ID \
      ParameterKey=MigrationAsgDesiredCapacity,ParameterValue=$MIGRATION_DESIRED_CAPACITY \
      ParameterKey=OneAsgDesiredCapacity,ParameterValue=$ONE_DESIRED_CAPACITY \
      ParameterKey=TwoAsgDesiredCapacity,ParameterValue=$TWO_DESIRED_CAPACITY \
  --stack-name Stack1

##
## Reset
##

export NON_MIGRATION_IMAGE_ID=ami-37884c4d
export ONE_DESIRED_CAPACITY=3
export TWO_DESIRED_CAPACITY=1

export MIGRATION_IMAGE_ID=ami-37884c4d
export MIGRATION_DESIRED_CAPACITY=0

aws cloudformation create-stack \
  --template-url https://s3.amazonaws.com/kevin-templates/ElbTemplate.json \
  --parameters \
      ParameterKey=EnvName,ParameterValue=blah \
      ParameterKey=BranchNameOrSha,ParameterValue=klb_elb_expers \
      ParameterKey=KeyName,ParameterValue=kevin_va_kp \
      ParameterKey=RepoUrl,ParameterValue=https://github.com/kevinburleigh75/aws_autoscaling.git \
      ParameterKey=NonMigrationImageId,ParameterValue=$NON_MIGRATION_IMAGE_ID \
      ParameterKey=MigrationImageId,ParameterValue=$MIGRATION_IMAGE_ID \
      ParameterKey=MigrationAsgDesiredCapacity,ParameterValue=$MIGRATION_DESIRED_CAPACITY \
      ParameterKey=OneAsgDesiredCapacity,ParameterValue=$ONE_DESIRED_CAPACITY \
      ParameterKey=TwoAsgDesiredCapacity,ParameterValue=$TWO_DESIRED_CAPACITY \
  --stack-name Stack1

aws cloudformation delete-stack --stack-name Stack1
